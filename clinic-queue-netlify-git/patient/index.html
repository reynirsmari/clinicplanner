
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Check-in</title>
  <style>
    :root { color-scheme: dark; }
    body{font-family:system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin:0; background:#0b0c10; color:#e5e7eb}
    .wrap{max-width:920px;margin:40px auto;padding:24px;border:1px solid rgba(255,255,255,.08);border-radius:20px;background:#101219}
    label{display:block;margin:14px 0 6px;color:#cbd5e1}
    input, select, textarea{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #263043;background:#0f1117;color:#e5e7eb}
    button{margin-top:16px;padding:12px 16px;border-radius:12px;border:0;background:#2563eb;color:white;font-weight:700}
  </style>
</head>
<body>
  <main class="wrap">
    <h1>Patient checkâ€‘in</h1>
    <form id="f">
      <label>Full name</label>
      <input required name="name" placeholder="Jane Doe" />
      <label>National ID / KT</label>
      <input required name="kt" />
      <label>Phone</label>
      <input required name="phone" />
      <label>Primary complaint</label>
      <select name="complaint">
        <option>Respiratory</option>
        <option>Gastrointestinal</option>
        <option>Dermatological</option>
        <option>Musculoskeletal</option>
        <option>Neurological</option>
        <option>Ophthalmological</option>
        <option>ENT (Ear, Nose, Throat)</option>
        <option>Urological</option>
        <option>Gynecological</option>
        <option>General</option>
      </select>
      <label>Notes (optional)</label>
      <textarea name="notes" rows="4" placeholder="Short notes for the clinic"></textarea>
      <button type="submit">Get my ticket</button>
    </form>
  </main>
  <script type="module">
    const form = document.getElementById("f");
    form.addEventListener("submit", async (e)=>{
      e.preventDefault();
      const payload = Object.fromEntries(new FormData(form).entries());
      // build record expected by API
      payload.acute = false; // removed from UI, keep schema simple
      payload.status = "waiting";
      payload.createdAt = new Date().toISOString();
      try{
        const res = await fetch("/api/tickets-create", {
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        if(data && data.id){
          location.href = `/patient/ticket.html?id=${encodeURIComponent(data.id)}`;
        } else {
          alert("Sorry, we could not create your ticket. Please try again.");
        }
      }catch(err){
        alert("Sorry, something went wrong. Please try again.");
      }
    });
  </script>
</body>
</html>
